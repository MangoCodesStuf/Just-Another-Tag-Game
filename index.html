<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Just Another Tag Game</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html,body{
      margin:0;
      background:#fff;
      font-family: Arial, Helvetica, sans-serif;
      height:100%;
    }

    /* page layout: iframe on left, instruction on right */
    .page {
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      gap:18px;
      padding-top:22px;
    }

    /* instruction box on the right */
    #instruction {
      width:220px;
      padding:14px;
      box-sizing:border-box;
      color:#111;
      font-weight:700;
      font-size:16px;
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:10px;
      user-select:none;
    }
    #instruction .arrow {
      font-size:26px;
      color:#111;
      transform: translateY(2px);
    }
    #instruction small {
      font-weight:400;
      font-size:13px;
      color:#444;
    }

    /* crop area - exact as your working version */
    .scale-wrapper{
      width:440px;
      height:400px;
      transform: scale(2.75);
      transform-origin: top center;
    }
    .crop{
      width:440px;
      height:390px;
      overflow:hidden;
      position:relative;
      background:white;
      /* no shadow (explicitly removed) */
      box-shadow: none;
    }

    iframe{
      width:440px;
      height:757px;
      border:0;
      display:block;
      transform: translateY(-20px);
    }

    /* small helper message after successful click (optional) */
    #doneHint{
      margin-top:6px;
      color:#666;
      font-size:13px;
      display:none;
    }

    /* small responsive fallback on narrow screens */
    @media (max-width:700px){
      .page{ flex-direction:column; align-items:center; gap:8px; padding-top:12px; }
      #instruction{ width:100%; max-width:320px; text-align:center; align-items:center; }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="scale-wrapper">
      <div class="crop">
        <iframe
          id="gameFrame"
          title="Just Another Tag Game"
          src="https://studio.code.org/projects/gamelab/60986542-df28-40a6-b628-176ee531402e/embed"
          allowfullscreen>
        </iframe>
      </div>
    </div>

    <div id="instruction" role="note" aria-live="polite">
      <div>Click once to run</div>
      <div class="arrow">→</div>
      <small>Click the game area (left) to activate controls and sound.</small>
      <div id="doneHint">Thanks — you can now use the game.</div>
    </div>
  </div>

  <script>
    (function(){
      const instruction = document.getElementById('instruction');
      const doneHint = document.getElementById('doneHint');
      const iframe = document.getElementById('gameFrame');
      let hidden = false;
      let pollInterval = null;

      function hideInstruction(){
        if(hidden) return;
        hidden = true;
        instruction.style.display = 'none';
        doneHint.style.display = 'none';
        cleanup();
      }

      function cleanup(){
        iframe.removeEventListener('pointerdown', onIframePointerDown);
        iframe.removeEventListener('focus', onIframeFocus);
        window.removeEventListener('message', onMessage);
        document.removeEventListener('visibilitychange', onVisibilityChange);
        if(pollInterval){ clearInterval(pollInterval); pollInterval = null; }
      }

      // Fired when user presses inside iframe area (most reliable)
      function onIframePointerDown(){
        hideInstruction();
      }

      // Fired when iframe receives focus (some browsers)
      function onIframeFocus(){
        hideInstruction();
      }

      // Polling fallback: check if iframe is active element
      function startPolling(){
        if(pollInterval) return;
        pollInterval = setInterval(() => {
          try {
            if(document.activeElement === iframe){
              hideInstruction();
            }
          } catch(e){
            // ignore cross-origin errors
          }
        }, 150);
      }

      // Message listener (extra fallback in case embed posts a message)
      function onMessage(e){
        // not relying on origin here; any message => assume iframe active for UX
        hideInstruction();
      }

      // If page visibility changes, start polling (fallback for some mobile browsers)
      function onVisibilityChange(){
        startPolling();
      }

      // Attach handlers after iframe loads (but also attach polling immediately)
      iframe.addEventListener('pointerdown', onIframePointerDown); // user presses the iframe element
      iframe.addEventListener('focus', onIframeFocus);             // iframe focus event
      window.addEventListener('message', onMessage, false);       // extra fallback
      document.addEventListener('visibilitychange', onVisibilityChange);
      startPolling();

      // Note: we do NOT attempt to programmatically focus the iframe here (that can cause false positives).
      // Instruction will remain until a real user action activates the iframe.
    })();
  </script>
</body>
</html>
